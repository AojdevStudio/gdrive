---
phase: 01-api-consistency
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/modules/calendar/types.ts
  - src/modules/calendar/read.ts
  - src/modules/calendar/create.ts
  - src/modules/calendar/update.ts
  - src/modules/calendar/delete.ts
  - src/modules/calendar/__tests__/delete.test.ts
  - src/tools/listTools.ts
autonomous: true

must_haves:
  truths:
    - "Calendar EventResult returns `eventId` matching input parameter naming"
    - "Calendar deleteEvent returns DeleteEventResult type with `eventId` field"
    - "AI agents can use consistent `eventId` across all Calendar event operations"
  artifacts:
    - path: "src/modules/calendar/types.ts"
      provides: "EventResult with eventId field"
      contains: "eventId: string"
    - path: "src/modules/calendar/delete.ts"
      provides: "deleteEvent returning DeleteEventResult type"
      contains: "Promise<DeleteEventResult>"
    - path: "src/modules/calendar/__tests__/delete.test.ts"
      provides: "Unit tests for deleteEvent return type"
      min_lines: 60
  key_links:
    - from: "src/modules/calendar/read.ts"
      to: "src/modules/calendar/types.ts"
      via: "imports and returns EventResult"
      pattern: "eventId: event\\.id"
    - from: "src/modules/calendar/delete.ts"
      to: "src/modules/calendar/types.ts"
      via: "imports and returns DeleteEventResult"
      pattern: "Promise<DeleteEventResult>"
---

<objective>
Fix Calendar module API consistency: (1) Change `EventResult.id` to `eventId` for consistency with input parameters, and (2) Change `deleteEvent` return type from inline `{ success, message }` to proper `DeleteEventResult` with `eventId`.

Purpose: AI agents should see consistent naming between input options (`eventId`) and output results (`eventId`). Currently, you pass `eventId` to get an event but receive `id` in the result, causing confusion.

Output: Updated Calendar types, implementations across read/create/update/delete, unit tests, and tool documentation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-api-consistency/01-RESEARCH.md

# Source files to modify
@src/modules/calendar/types.ts
@src/modules/calendar/read.ts
@src/modules/calendar/create.ts
@src/modules/calendar/update.ts
@src/modules/calendar/delete.ts
@src/tools/listTools.ts

# Test pattern reference
@src/modules/calendar/__tests__/read.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Calendar types - EventResult and verify DeleteEventResult</name>
  <files>
    src/modules/calendar/types.ts
  </files>
  <action>
1. In `src/modules/calendar/types.ts`:

   **EventResult type (line ~130-164):**
   - Change `id: string;` to `eventId: string;`
   - This is the core change that affects read.ts, create.ts, update.ts

   **DeleteEventResult type (lines ~282-285):**
   - Already correctly defined with `eventId: string; message: string;`
   - No changes needed to this type, just verify it exists

2. Verify EventSummary (line ~56) still uses `id` - this is intentional for list operations which return summary data matching Google API.

The distinction is:
- `EventSummary.id` - Used in list operations, matches Google API response
- `EventResult.eventId` - Used in single-resource operations, matches input parameter naming
  </action>
  <verify>
Run `npm run build` - will show errors in read.ts, create.ts, update.ts that need fixing in Task 2.
This is expected - the type change intentionally breaks compilation to ensure all usages are updated.
  </verify>
  <done>
- `EventResult` interface has `eventId: string` not `id: string`
- `DeleteEventResult` exists with `eventId: string` and `message: string`
- `EventSummary` still uses `id` (intentional for list operations)
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Calendar implementations - read, create, update, delete</name>
  <files>
    src/modules/calendar/read.ts
    src/modules/calendar/create.ts
    src/modules/calendar/update.ts
    src/modules/calendar/delete.ts
  </files>
  <action>
1. **src/modules/calendar/read.ts** (getEvent function, line ~145-198):
   - Update result object construction (line ~164):
     Change `id: event.id!,` to `eventId: event.id!,`
   - The Google API returns `event.id`, we map it to `eventId` in our result

2. **src/modules/calendar/create.ts** (createEvent function, line ~109-298):
   - Update result object construction (line ~245):
     Change `id: event.id!,` to `eventId: event.id!,`
   - Also check quickAdd function (line ~413-452) if it builds EventResult

3. **src/modules/calendar/update.ts** (updateEvent function, line ~108-291):
   - Update result object construction (line ~232):
     Change `id: event.id!,` to `eventId: event.id!,`

4. **src/modules/calendar/delete.ts** (deleteEvent function, line ~45-85):
   - Change return type from `Promise<{ success: boolean; message: string }>` to `Promise<DeleteEventResult>`
   - Import `DeleteEventResult` from `./types.js`
   - Change return statement from:
     ```typescript
     return {
       success: true,
       message: 'Event deleted successfully',
     };
     ```
     to:
     ```typescript
     return {
       eventId,
       message: 'Event deleted successfully',
     };
     ```
   - Note: Removing `success` field - the presence of a result indicates success, exceptions indicate failure. This is the standard pattern used elsewhere.
  </action>
  <verify>
Run `npm run build` - should now compile successfully after all implementations updated.
Run existing calendar tests: `npm test -- --testPathPattern="calendar"` - existing tests may need updates.
  </verify>
  <done>
- `getEvent` returns `EventResult` with `eventId` field
- `createEvent` returns with `eventId` field
- `updateEvent` returns with `eventId` field
- `deleteEvent` returns `DeleteEventResult` with `eventId` and `message`
- Build passes with no TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Create/update tests and documentation</name>
  <files>
    src/modules/calendar/__tests__/delete.test.ts
    src/modules/calendar/__tests__/read.test.ts
    src/tools/listTools.ts
  </files>
  <action>
1. **Create `src/modules/calendar/__tests__/delete.test.ts`:**

   Follow pattern from read.test.ts:
   ```typescript
   import { describe, test, expect, beforeEach, jest } from '@jest/globals';
   import { deleteEvent } from '../delete.js';

   describe('deleteEvent', () => {
     // Mock context setup (same pattern as read.test.ts)

     test('returns DeleteEventResult with eventId', async () => {
       // Verify result has eventId and message, NOT success
     });

     test('invalidates correct cache keys', async () => {
       // Verify cache invalidation patterns
     });

     test('tracks performance', async () => {
       // Verify performanceMonitor.track called
     });

     test('logs deletion', async () => {
       // Verify logger.info called with correct params
     });

     test('passes sendUpdates to API', async () => {
       // Verify Google API called with sendUpdates parameter
     });
   });
   ```

2. **Update existing `src/modules/calendar/__tests__/read.test.ts`:**
   - Update assertions that check `result.id` to check `result.eventId`
   - Line ~233: `expect(result.id).toBe('event123');` becomes `expect(result.eventId).toBe('event123');`
   - Check all getEvent tests for `.id` assertions

3. **Update `src/tools/listTools.ts`:**
   - No signature changes needed for Calendar tools (they already use `eventId` in input)
   - But verify the descriptions/examples are accurate
   - Check line ~285-288 for deleteEvent - signature already shows `eventId`
  </action>
  <verify>
Run all calendar tests: `npm test -- --testPathPattern="calendar"`
All tests should pass including new delete.test.ts.
  </verify>
  <done>
- New `delete.test.ts` exists with tests for DeleteEventResult
- Existing `read.test.ts` updated to check `eventId` not `id`
- All calendar tests pass
- Tool documentation verified accurate
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Build verification:**
   ```bash
   npm run build
   ```
   Should complete with no errors.

2. **Test verification:**
   ```bash
   npm test -- --testPathPattern="calendar"
   ```
   All Calendar tests should pass.

3. **Manual verification:**
   - Review `src/modules/calendar/types.ts` - `EventResult` has `eventId` not `id`
   - Review `src/modules/calendar/delete.ts` - returns `DeleteEventResult` not inline type
   - Grep for old patterns:
     ```bash
     grep -r "id: event\\.id" src/modules/calendar/
     grep -r "success: true" src/modules/calendar/delete.ts
     ```
     Should return no matches.
</verification>

<success_criteria>
- [ ] `EventResult` uses `eventId: string` field
- [ ] `getEvent` returns result with `eventId`
- [ ] `createEvent` returns result with `eventId`
- [ ] `updateEvent` returns result with `eventId`
- [ ] `deleteEvent` returns `DeleteEventResult` type with `eventId` and `message`
- [ ] `deleteEvent` does NOT return `{ success: boolean }`
- [ ] Unit tests exist and pass for deleteEvent
- [ ] Existing read tests updated and pass
- [ ] `npm run build` passes
- [ ] `npm test` passes (all calendar tests)
</success_criteria>

<output>
After completion, create `.planning/phases/01-api-consistency/01-02-SUMMARY.md`
</output>
