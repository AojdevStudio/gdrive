---
phase: 01-api-consistency
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/modules/gmail/types.ts
  - src/modules/gmail/labels.ts
  - src/modules/gmail/__tests__/labels.test.ts
  - src/tools/listTools.ts
autonomous: true

must_haves:
  truths:
    - "Gmail modifyLabels accepts `id` parameter matching getMessage/getThread pattern"
    - "Gmail modifyLabels returns result with `id` field matching input"
    - "AI agents can use consistent `id` parameter across all Gmail single-resource operations"
  artifacts:
    - path: "src/modules/gmail/types.ts"
      provides: "ModifyLabelsOptions and ModifyLabelsResult types with id parameter"
      contains: "id: string"
    - path: "src/modules/gmail/labels.ts"
      provides: "modifyLabels implementation using id parameter"
      contains: "const { id, addLabelIds, removeLabelIds } = options"
    - path: "src/modules/gmail/__tests__/labels.test.ts"
      provides: "Unit tests for modifyLabels with id parameter"
      min_lines: 80
    - path: "src/tools/listTools.ts"
      provides: "Updated tool documentation with id parameter"
      contains: "modifyLabels({ id: string"
  key_links:
    - from: "src/modules/gmail/labels.ts"
      to: "src/modules/gmail/types.ts"
      via: "imports ModifyLabelsOptions, ModifyLabelsResult"
      pattern: "import.*ModifyLabelsOptions.*ModifyLabelsResult"
    - from: "src/modules/gmail/labels.ts"
      to: "gmail.users.messages.modify"
      via: "passes id to Google API"
      pattern: "id: id"
---

<objective>
Fix Gmail `modifyLabels` parameter naming to use `id` instead of `messageId` for consistency with `getMessage` and `getThread` operations.

Purpose: AI agents should use the same `id` parameter across all Gmail single-resource operations. Currently, `modifyLabels` uses `messageId` while `getMessage` and `getThread` use `id`, causing confusion.

Output: Updated Gmail types, implementation, unit tests, and tool documentation with consistent `id` parameter.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-api-consistency/01-RESEARCH.md

# Source files to modify
@src/modules/gmail/types.ts
@src/modules/gmail/labels.ts
@src/tools/listTools.ts

# Test pattern reference
@src/modules/calendar/__tests__/read.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Gmail types and implementation</name>
  <files>
    src/modules/gmail/types.ts
    src/modules/gmail/labels.ts
  </files>
  <action>
1. In `src/modules/gmail/types.ts`:
   - Change `ModifyLabelsOptions.messageId` to `id` (line ~301)
   - Change `ModifyLabelsResult.messageId` to `id` (line ~312)
   - Keep JSDoc comments updated to say "The message ID"

2. In `src/modules/gmail/labels.ts`:
   - Update destructuring from `messageId` to `id` (line ~126)
   - Update the Google API call to use `id: id` (line ~141)
   - Update cache invalidation to use `id` (line ~148)
   - Update logger.info to use `id` (line ~152)
   - Update return object to use `id` (line ~158)

The Google Gmail API call already uses `id` parameter internally, so the API call itself (`context.gmail.users.messages.modify`) just needs the variable name change.
  </action>
  <verify>
Run `npm run build` to verify TypeScript compiles without errors.
Run `npm run type-check` if available.
  </verify>
  <done>
- `ModifyLabelsOptions` has `id: string` not `messageId: string`
- `ModifyLabelsResult` has `id: string` not `messageId: string`
- `modifyLabels` function uses `id` throughout implementation
- Build passes with no TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Gmail labels unit tests</name>
  <files>
    src/modules/gmail/__tests__/labels.test.ts
  </files>
  <action>
Create new test file following the pattern from `calendar/__tests__/read.test.ts`:

1. Create directory `src/modules/gmail/__tests__/` if it doesn't exist

2. Create `labels.test.ts` with:
   - Import Jest globals: `describe, test, expect, beforeEach, jest`
   - Import `modifyLabels` from `../labels.js`
   - Create mock context with: logger, gmail API, cacheManager, performanceMonitor, startTime

3. Test cases for `modifyLabels`:
   - "modifies labels with id parameter" - verify API called with correct id
   - "returns result with id field" - verify result.id matches input
   - "invalidates cache with correct message id" - verify cache keys use id
   - "logs with id parameter" - verify logger.info called with id
   - "tracks performance" - verify performanceMonitor.track called
   - "handles add labels only" - verify requestBody has addLabelIds
   - "handles remove labels only" - verify requestBody has removeLabelIds
   - "handles both add and remove" - verify both in requestBody

Mock structure:
```typescript
mockGmailApi = {
  users: {
    messages: {
      modify: jest.fn(),
    },
  },
};
```
  </action>
  <verify>
Run `npm test -- --testPathPattern="gmail.*labels"` to verify tests pass.
Run `npm test -- --coverage --testPathPattern="gmail.*labels"` to check coverage.
  </verify>
  <done>
- Test file exists at `src/modules/gmail/__tests__/labels.test.ts`
- All 8 test cases pass
- Tests verify `id` parameter is used (not `messageId`)
- Coverage shows modifyLabels function is tested
  </done>
</task>

<task type="auto">
  <name>Task 3: Update tool documentation</name>
  <files>
    src/tools/listTools.ts
  </files>
  <action>
Update the Gmail section in listTools.ts:

1. Find the `modifyLabels` entry (around line 241-244)

2. Change signature from:
   `'modifyLabels({ messageId: string, addLabelIds?: string[], removeLabelIds?: string[] })'`
   to:
   `'modifyLabels({ id: string, addLabelIds?: string[], removeLabelIds?: string[] })'`

3. Change example from:
   `'gmail.modifyLabels({ messageId: "18c123abc", removeLabelIds: ["UNREAD", "INBOX"] })'`
   to:
   `'gmail.modifyLabels({ id: "18c123abc", removeLabelIds: ["UNREAD", "INBOX"] })'`

This ensures AI agents see the correct parameter name in tool discovery.
  </action>
  <verify>
Run `npm run build` to ensure no syntax errors.
Grep the file: `grep -n "modifyLabels" src/tools/listTools.ts` should show `id:` not `messageId:`.
  </verify>
  <done>
- listTools.ts shows `modifyLabels({ id: string, ...})`
- Example uses `id:` not `messageId:`
- Build passes
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Build verification:**
   ```bash
   npm run build
   ```
   Should complete with no errors.

2. **Test verification:**
   ```bash
   npm test -- --testPathPattern="gmail"
   ```
   All Gmail tests should pass.

3. **Manual verification:**
   - Review `src/modules/gmail/types.ts` - no `messageId` in ModifyLabels types
   - Review `src/modules/gmail/labels.ts` - all uses of `messageId` replaced with `id`
   - Review `src/tools/listTools.ts` - modifyLabels signature uses `id`
</verification>

<success_criteria>
- [ ] `ModifyLabelsOptions` uses `id: string` parameter
- [ ] `ModifyLabelsResult` uses `id: string` field
- [ ] `modifyLabels` implementation uses `id` throughout
- [ ] Unit tests exist and pass for modifyLabels
- [ ] listTools.ts documentation shows `id` parameter
- [ ] `npm run build` passes
- [ ] `npm test` passes (existing + new tests)
</success_criteria>

<output>
After completion, create `.planning/phases/01-api-consistency/01-01-SUMMARY.md`
</output>
